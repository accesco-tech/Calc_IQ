<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Monthly Budget AI | Accesco</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #700457;
    --primary-light: #9d2b82;
    --primary-soft: rgba(112, 4, 87, 0.05);
    --bg: #f8fafc;
    --card: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --accent-green: #10b981;
    --border: #e2e8f0;
}

* { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.2s ease; }

body { 
    margin: 0; 
    background-color: var(--bg);
    background-image: radial-gradient(at 0% 0%, rgba(112, 4, 87, 0.05) 0px, transparent 50%),
                      radial-gradient(at 100% 100%, rgba(112, 4, 87, 0.05) 0px, transparent 50%);
    color: var(--text-main); 
    min-height: 100vh;
}

.wrapper { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }

/* HEADER / LOGO SECTION */
.header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    margin-bottom: 48px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
}

.brand { display: flex; gap: 16px; align-items: center; }

/* Path matches your screenshot: templates/static/accesco.png */
.logo-container {
    width: 48px;
    height: 48px;
    background: white;
    padding: 8px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.logo-container img { width: 100%; height: 100%; object-fit: contain; }

.brand-text h1 { margin: 0; font-size: 22px; font-weight: 800; letter-spacing: -0.5px; color: var(--primary); }
.brand-text span { font-size: 13px; color: var(--text-muted); font-weight: 500; }

/* LAYOUT */
.grid { display: grid; grid-template-columns: 400px 1fr; gap: 40px; align-items: start; }

.card { 
    background: var(--card); 
    border-radius: 24px; 
    padding: 32px; 
    border: 1px solid rgba(112, 4, 87, 0.1);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
}

.step-pill {
    display: inline-block;
    padding: 4px 12px;
    background: var(--primary-soft);
    color: var(--primary);
    border-radius: 100px;
    font-size: 11px;
    font-weight: 700;
    margin-bottom: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

h2 { margin: 0 0 24px; font-size: 24px; font-weight: 700; color: #0f172a; }

/* FORM ELEMENTS */
.input-group { margin-bottom: 20px; }
label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 600; color: var(--text-main); }
input { 
    width: 100%; 
    padding: 14px 16px; 
    border-radius: 12px; 
    border: 1.5px solid var(--border); 
    font-size: 15px;
    background: #fcfcfd;
}
input:focus { outline: none; border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px var(--primary-soft); }

.cta { 
    margin-top: 10px; 
    width: 100%; 
    padding: 16px; 
    background: var(--primary); 
    color: white; 
    font-weight: 700; 
    border-radius: 14px; 
    border: none; 
    cursor: pointer; 
    font-size: 16px;
    box-shadow: 0 10px 15px -3px rgba(112, 4, 87, 0.3);
}
.cta:hover { background: var(--primary-light); transform: translateY(-1px); }
.cta:active { transform: translateY(0); }

/* RESULTS */
.hidden { display: none; opacity: 0; }
#result { animation: fadeIn 0.5s forwards; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 30px; }
.metric { 
    padding: 20px; 
    border-radius: 20px; 
    background: var(--primary-soft); 
    border: 1px solid rgba(112, 4, 87, 0.05);
    text-align: center;
}
.metric span { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
.metric strong { display: block; font-size: 20px; color: var(--primary); margin-top: 4px; }

.result-content { display: flex; gap: 40px; align-items: flex-start; }
.chart-container { flex: 0 0 250px; }

.table-container { flex: 1; }
table { width: 100%; border-collapse: collapse; }
td { padding: 14px 0; border-bottom: 1px solid #f1f5f9; font-size: 14px; text-transform: capitalize; }
td:last-child { text-align: right; font-weight: 700; color: var(--primary); font-family: monospace; font-size: 16px; }

@media (max-width: 1000px) { 
    .grid { grid-template-columns: 1fr; } 
    .result-content { flex-direction: column; align-items: center; }
    .chart-container { width: 100%; max-width: 300px; }
}
</style>
</head>
<body>

<div class="wrapper">
    <header class="header">
        <div class="brand">
            <div class="logo-container">
                <img src="{{ url_for('static', path='/accesco_original.png') }}" alt="Accesco Logo">
            </div>
            <div class="brand-text">
                <h1>Accesco AI</h1>
                <span>Smart Financial Planning</span>
            </div>
        </div>
        <div class="brand-text" style="text-align: right;">
            <span style="display: block; font-weight: 700; color: var(--primary);">INDIA</span>
            <span>Version 2.0</span>
        </div>
    </header>

    <div class="grid">
        <aside class="card">
            <span class="step-pill">Step 1: Input</span>
            <h2>Enter Details</h2>
            
            <div class="input-group">
                <label>Monthly Income</label>
                <input id="income" type="number" value="50000" placeholder="e.g. 50000">
            </div>

            <div class="input-group">
                <label>Rent / EMI</label>
                <input id="rent" type="number" value="15000">
            </div>

            <div class="input-group">
                <label>City Cost Index (1.0 = Avg)</label>
                <input id="cost_index" type="number" step="0.1" value="1.0">
            </div>

            <div class="input-group">
                <label>Family Members</label>
                <input id="family_members" type="number" value="1">
            </div>

            <button class="cta" onclick="generate()">Generate Prediction</button>
        </aside>

        <main class="card hidden" id="result">
            <span class="step-pill">Step 2: Analysis</span>
            <h2>Your AI Budget</h2>
            
            <div class="summary">
                <div class="metric"><span>Needs</span><strong id="needs">₹0</strong></div>
                <div class="metric"><span>Wants</span><strong id="wants">₹0</strong></div>
                <div class="metric"><span>Savings</span><strong id="savings">₹0</strong></div>
            </div>

            <div class="result-content">
                <div class="chart-container">
                    <canvas id="chart"></canvas>
                </div>
                <div class="table-container">
                    <table id="table"></table>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
let chart;

// Format numbers as Indian Rupees
function inr(v) { 
    return "₹" + Math.round(v).toLocaleString("en-IN"); 
}

// Chart.js update logic
function updateChart(needs, wants, savings) {
    const ctx = document.getElementById('chart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
        type: "doughnut",
        data: {
            labels: ["Needs", "Wants", "Savings"],
            datasets: [{
                data: [needs, wants, savings],
                backgroundColor: ["#700457", "#9d2b82", "#e2e8f0"],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: { 
            cutout: "75%", 
            plugins: { 
                legend: { position: "bottom", labels: { usePointStyle: true, padding: 20, font: { weight: '600' } } } 
            } 
        }
    });
}

async function generate() {
    // 1. Gather data with correct types
    const payload = {
        income: parseFloat(document.getElementById('income').value),
        rent: parseFloat(document.getElementById('rent').value),
        cost_index: parseFloat(document.getElementById('cost_index').value),
        family_members: parseInt(document.getElementById('family_members').value)
    };

    try {
        // 2. Send request to Render FastAPI /predict route
        const res = await fetch("/predict", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        // 3. Catch validation errors (Family 1-10, Index 0.7-1.6)
        let d;

        try {
            d = await res.json();
        } catch (err) {
            console.error("Invalid JSON from server");
            alert("Server error. Please try again.");
            return;
        }

        if (!res.ok) {
            alert("Input Error! Please ensure:\n- Family Members: 1 to 10\n- City Index: 0.7 to 1.6");
            return;
        }

        
        // 4. Calculate Grouped Totals for UI categories
        const needsVal = payload.rent + (d.grocery_and_essentials || 0) + (d.education || 0) + (d.healthcare || 0);
        const wantsVal = (d.transport || 0) + (d.travel || 0) + (d.entertainment || 0);
        const savingsVal = d.savings || 0;

        // 5. Update UI text boxes
        document.getElementById('needs').textContent = inr(needsVal);
        document.getElementById('wants').textContent = inr(wantsVal);
        document.getElementById('savings').textContent = inr(savingsVal);

        // 6. Populate breakdown table
        const table = document.getElementById('table');
        table.innerHTML = "";
        Object.entries(d).forEach(([k, v]) => {
            table.innerHTML += `<tr><td>${k.replace(/_/g, " ")}</td><td>${inr(v)}</td></tr>`;
        });

        // 7. IMPORTANT: REVEAL THE HIDDEN RESULTS CARD
        document.getElementById("result").classList.remove("hidden");
        updateChart(needsVal, wantsVal, savingsVal);

    } catch (e) { 
        console.error("Connection error:", e);
        alert("Server communication failed. Please check your internet.");
    }
}
</script>
</body>
</html>
